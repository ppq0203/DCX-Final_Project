<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="project.momento.sign.mapper.SignMapper">	<!-- xml파일을 사용할 mapper가 있는 경로 -->
<!-- Heidisql연결후 입력 저장-->
	<!-- INSERT문 -->
	<insert id="insertUser" parameterType="project.momento.sign.dto.SignDto">
		<![CDATA[
			INSERT INTO USER
			(	
<<<<<<< HEAD
				PK_USER_SEQ,
=======
				PK_AUTH_SEQ,
>>>>>>> refs/remotes/origin/LMS_all
				USER_ID,
				PASSWORD,
				NAME,
				PHONE,
				BIRTHDAY,
				ADDRESS,
				DETAILED_ADDRESS,
				EMAIL,
				USER_DIVN,
				USE_YN,
				REGIST_DT
			)
			VALUES
			(	
<<<<<<< HEAD
				ifnull(#{pkUserSeq}, null),
=======
				#{pkAuthSeq},
>>>>>>> refs/remotes/origin/LMS_all
				#{userId},
				#{password},
				#{name},
				#{phone},
				#{birthday},
				#{address},
				#{detailedAddress},
				#{email},
				#{userDivn},
				#{useYn},
				SYSDATE()
			)
			ON DUPLICATE KEY UPDATE
			USE_YN = 'Y' WHERE USE_YN != 'D'
		]]>
	</insert>
	
	<!-- 가입허가 UPDATE문 -->		<!--USE_YN의 상태가 n인 데이터만 모아 Y로 바꿔주기.-->
	<update id="userList" parameterType="project.momento.login.dto.LoginDto">
		<foreach item="item" index="index" collection="userList">
			UPDATE USER SET USE_YN = 'Y' WHERE USE_YN != 'D' AND USER_ID=#{item.userId}
		</foreach>
	</update>
	
	<!-- 아이디 중복 체크      parameterType: 중복된 id가 있는지 보내는 ,  resultType: 중복된 id가 있거나 없다는 걸 알려주는  -->
 	<select id="checkButton" parameterType="project.momento.sign.dto.SignDto" resultType="int" >
		SELECT COUNT(USER_ID) AS cnt FROM USER WHERE USER_ID=#{userId} AND USE_YN != 'D' <!-- FROM뒤에는 사용하는 table이름 -->
	</select>
	
	<!-- DELETE문 -->
	
</mapper>